【2020年5月1日】整理自[【微擎开发文档】](http://s.w7.cc/index.php?c=wiki&do=view&id=1&list=13)


# 微擎

## 入门介绍

微擎是基于目前最流行的 WEB2.0 的架构（php+mysql），运行环境我们推荐使用：

* linux(centOS)
* nginx
* php5.3
* mysql5.6

> 更多了解可跳转自[【入门指引】](http://s.w7.cc/index.php?c=wiki&do=view&id=1&list=19)

### 环境安装

服务器环境要求：

* IIS/Apache/Nginx
* PHP>=5.6
* MySQL>=5

> 更多了解可跳转自[【环境安装】](http://s.w7.cc/index.php?c=wiki&do=view&id=1&list=26)

## 框架使用

### 入口脚本

入口脚本是应用启动流程中的第一环，入口文件根据 **`系统配置文件`** 初始化了系统的常量、全局变量及全局对象，并将终端用户的请求通过入口脚本将请求转发到各自的功能模块中

微擎系统中分为三个入口，分别是：

* Web 端入口
* App 端入口
* 微信 Api 入口

### 系统配置文件

系统配置文件存放着微擎系统重要的启动数据，文件是 `/data/config.php`

> 此文件禁止普通用户修改

### Web 端入口

Web 端入口主要负责微擎系统的后台管理功能

* 入口文件是 `/web/index.php`

* 访问此入口有严格的权限判断，需要用户进行登录

* 此入口主要完成以下工作：

  * 登录用户的身份验证
  * 初始化登录用户的身份信息，分派管理员权限或是操作员权限
  * 权限菜单划分及权限判断
  * 加载系统配置
  * 路由用户的请求

### App 端入口

App 端入口主要负责微擎系统的前端 **`微站`** 、**`个人中心`** 及其它普通用户访问的功能

* 入口文件是 `/app/index.php`

* 访问 **`微站`** 无需身份验证

  访问 **`个人中心`** 则要求用户进行登录

* 此入口主要完成以下工作：

  * 初始化当前公众号的数据
  * 初始化微站站点信息、风格、模板、导航等数据
  * 初始化粉丝&会员的身份信息（如果有权限获取）
  * 加载系统配置
  * 路由用户的请求

### 微信 Api 入口

微信 Api 入口主要负责处理微信公众平台请求微擎系统的关键字、图片、语音等数据

* 入口文件是 `api.php`

* 此入口只用于公众平台访问

* 此入口主要完成以下工作：

  * 初始化当前公众号的数据
  * 解析公众平台推送过来的数据结构，转化为微擎消息结构
  * 根据消息结构中的关键字或是事件匹配到相应的模块
  * 调用模块的 processor 类返回数据给微信公共平台

## 目录结构

we7
├─ addons                                   模块安装目录(意为附加组件)
│  ├─ business                              模块的名称(示例)
│  │  ├─ images                             建议 css 文件也放此目录.
│  │  ├─ template                           模板目录
│  │  │  ├─ mobile                          APP 端模板目录
│  │  │  │  └─ ... *.html                   APP 端模板文件
│  │  │  └─ ... *.html                      Web 端模板文件
│  │  ├─ inc                                引用的 php 文件目录
│  │  │  ├─ mobile                          Mobile端目录
│  │  │  │  ├─ xxx.inc.php                  微站入口
│  │  │  │  └─ ...                          .
│  │  │  └─ web                             Web端模板目录
│  │  │      ├─ xxx.inc.php                 微站管理入口
│  │  │      └─ ...                         .
│  │  ├─ icon.jpg                           模块图标
│  │  ├─ preview.jpg                        模块预览
│  │  ├─ manifest.xm<x>l                       安装清单
│  │  ├─ module.php                         模块设置
│  │  ├─ processor.php                      消息处理
│  │  ├─ receiver.php                       消息订阅
│  │  ├─ webapp.php                         PC版页面功能
│  │  ├─ wxapp.php                          小程序接口功能
│  │  ├─ hook.php                           嵌入点
│  │  └─ site.php                           微站页面
│  └─ ...                                   其他扩展模块
├─ api                                      .
│  └─ accesstoken.php                        多系统共用accesstoken接口
│  └─ uc.php                                .
├─ attachment                               附件文件夹
│  ├─ audios                                音频附件文件夹
│  └─ images                                图片附件文件夹
│      ├─ global                            系统公共文件夹
│      │  └─ 上传年份
│      │        └─上传月份
│      │             └─ 随机文件名
│      └─ $uniacid ...                      按公众号年月组织的图片文件
├─ app                                      微站(Mobile)入口
│  ├─ common                                .
│  │  ├─ bootstrap.app.inc.php              .
│  │  ├─ common.func.php                    .
│  │  └─ template.func.php                  .
│  ├─ resource                              .
│  │  ├─ css                                .
│  │  ├─ fonts                              .
│  │  └─ js                                 .
│  ├─ source                                控制器
│  ├─ themes                                微站皮肤
│  │  ├─ default                            系统默认
│  │  └─ ...                                自定义皮肤
│  └─ index.php                             微站入口
├─ data                                     .
│  ├─ config.php                            系统配置
│  └─ db.php                                .
├─ framework                                微擎系统通用的工具类和方法
│  ├─ builtin                               微擎内建模块
│  │  ├─ basic                              文字回复模块
│  │  ├─ core                               会话消息统计
│  │  │  └─ receiver.php                    .
│  │  ├─ cover                              通用封面回复
│  │  ├─ default                            默认回复模块
│  │  ├─ music                              音乐回复模块
│  │  ├─ news                               图文回复模块
│  │  ├─ userapi                            自定义接口回复模块
│  │  └─ ...                                .
│  ├─ class                                 系统功能类                            .
│  ├─ function                              系统功能函数
│  ├─ library                               其他函数库
│  ├─ model                                 业务功能model
│  ├─ table                                 数据库表model
│  ├─ bootstrap.inc.php                     .
│  ├─ const.inc.php                         .
│  └─ version.inc.php                       .
├─ payment                                  支付
├─ web                                      后台管理(Web)入口
│  ├─ common                                公用文件
│  │  ├─ bootstrap.sys.inc.php              .
│  │  ├─ common.func.php                    .
│  │  ├─ frames.inc.php                     .
│  │  └─ template.func.php                  .
│  ├─ resource                              资源文件
│  │  ├─ components                         JS组件
│  │  ├─ css                                样式文件
│  │  ├─ fonts                              字体资源
│  │  ├─ images                             图片文件
│  │  └─ js                                 .
│  │      ├─ app                            系统js功能
│  │      ├─ lib                            js第三方库文件
│  │      └─ require.js                     .
│  ├─ source                                后台管理控制器
│  ├─ themes                                后台管理视图
│  │  ├─ default                            内建后台管理样式
│  │  └─ ...                                定制界面样式
│  └─ index.php                             后台入口
├─ api.php                                  公众平台与微擎系统通信的接口
├─ index.php                                微擎入口
└─ install.php                              微擎安装程序

### 结构图

![图片](http://cdn.w7.cc/images/2017/12/28/15144252165a444b808426a_bFbFFzc20BfL.png)

## 数据库字典

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































